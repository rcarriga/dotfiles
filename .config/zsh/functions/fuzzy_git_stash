GIT_EXEC="${GIT_EXEC:-/usr/bin/git}"
PREVIEW="sha=\$(echo {} | awk '{ print \$1 }'); $GIT_EXEC diff \$sha | delta"

while out=$($GIT_EXEC stash list --pretty="%C(red)%gd %C(yellow)%h %>(14)%Cgreen%cr %C(white)%gs" --color=always | fzf --ansi --no-sort --preview $PREVIEW); do
  sha=$(echo $out | awk '{print $1}')
  $GIT_EXEC stash pop $sha
done
